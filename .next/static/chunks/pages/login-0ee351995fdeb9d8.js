(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[459],{3236:function(e,t,o){(window.__NEXT_P=window.__NEXT_P||[]).push(["/login",function(){return o(1153)}])},1153:function(e,t,o){"use strict";o.r(t);var n=o(5893),s=o(7294),i=o(1163),r=o(9008),a=o.n(r),c=o(7066);o(6501);var l=o(3454);let u=c.Z.create({baseURL:"/api"});u.interceptors.response.use(e=>e,e=>e.response?Promise.reject(e.response.data):e.request?Promise.reject({error:"無法連接到伺服器"}):Promise.reject({error:"發生錯誤"})),t.default=()=>{let e=(0,i.useRouter)(),[t,o]=(0,s.useState)(!0),[r,c]=(0,s.useState)(""),[d,f]=(0,s.useState)(""),[h,g]=(0,s.useState)(""),[p,m]=(0,s.useState)(!1),[x,N]=(0,s.useState)(""),[b,y]=(0,s.useState)(!1),j=async n=>{if(n.preventDefault(),N(""),y(!0),!t&&d!==h){N("密碼不匹配"),y(!1);return}try{let{data:n}=await u.post("/auth",{action:t?"login":"register",username:r,password:d});if(console.log("data",n),"Registration successful. You can now subscribe to LINE Notify."===n.message&&o(!0),n.user&&(localStorage.setItem("user",JSON.stringify(n.user)),n.message))switch(n.user.lineNotifyStatus){case"NEEDS_REAUTHORIZATION":if(console.log("需要重新授權 LINE Notify"),confirm("需要重新授權訂閱,是否重新訂閱")){let t=encodeURIComponent(n.userId.toString()),o=l.env.LINE_NOTIFY_REDIRECT_URI;e.push("https://notify-bot.line.me/oauth/authorize?response_type=code&client_id=".concat(l.env.LINE_NOTIFY_CLIENT_ID,"&redirect_uri=").concat(o,"&scope=notify&state=").concat(t))}break;case"NOT_SUBSCRIBED":if(console.log("未訂閱 LINE Notify"),confirm("你還未訂閱 LINE Notify。是否現在訂閱？")){let t=encodeURIComponent(n.userId.toString());console.log("LINE_NOTIFY_CLIENT_ID","8EoehpU7h7N1m5RR4UagnA"),console.log("LINE_NOTIFY_REDIRECT_URI","http://localhost:3000/api/callback");let o=async()=>{e.push("https://notify-bot.line.me/oauth/authorize?response_type=code&client_id=".concat("8EoehpU7h7N1m5RR4UagnA","&redirect_uri=").concat("http://localhost:3000/api/callback","&scope=notify&state=").concat(t))};await o()}break;case"SUBSCRIBED":console.log("已訂閱 LINE Notify"),confirm("已訂閱"),e.push("/591");break;default:console.log("未知的 LINE Notify 狀態")}}catch(e){console.log("error",e),N(e.message||"發生未知錯誤")}finally{y(!1)}};return(0,n.jsxs)("div",{className:"min-h-screen flex items-center justify-center bg-gradient-to-br from-indigo-500 via-purple-500 to-pink-500",children:[(0,n.jsxs)(a(),{children:[(0,n.jsx)("meta",{name:"description",content:t?"登入頁面":"註冊頁面"}),(0,n.jsx)("link",{rel:"icon",href:"/favicon.ico"})]}),(0,n.jsxs)("div",{className:"bg-white p-10 rounded-2xl shadow-2xl w-96 max-w-md transition-all duration-300 ease-in-out transform hover:scale-105",children:[(0,n.jsx)("div",{className:"flex justify-center mb-8",children:(0,n.jsx)("div",{className:"w-24 h-24 bg-gradient-to-r from-blue-400 to-indigo-500 rounded-full flex items-center justify-center shadow-lg",children:(0,n.jsx)("svg",{className:"w-14 h-14 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})})})}),x&&(0,n.jsx)("div",{className:"mb-6 text-red-500 text-center font-semibold bg-red-100 py-2 rounded-lg",children:x}),(0,n.jsxs)("form",{onSubmit:j,className:"space-y-6",children:[(0,n.jsx)("div",{children:(0,n.jsx)("input",{type:"text",placeholder:"用戶名 / ID",className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 transition duration-200",value:r,onChange:e=>c(e.target.value),required:!0})}),(0,n.jsx)("div",{children:(0,n.jsx)("input",{type:"password",placeholder:"密碼",className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 transition duration-200",value:d,onChange:e=>f(e.target.value),required:!0})}),!t&&(0,n.jsx)("div",{children:(0,n.jsx)("input",{type:"password",placeholder:"確認密碼",className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 transition duration-200",value:h,onChange:e=>g(e.target.value),required:!0})}),t&&(0,n.jsxs)("div",{className:"flex items-center justify-between",children:[(0,n.jsxs)("label",{className:"flex items-center",children:[(0,n.jsx)("input",{type:"checkbox",className:"form-checkbox h-5 w-5 text-indigo-600 transition duration-150 ease-in-out",checked:p,onChange:e=>m(e.target.checked)}),(0,n.jsx)("span",{className:"ml-2 text-sm text-gray-600",children:"記住我"})]}),(0,n.jsx)("a",{href:"#",className:"text-sm text-indigo-600 hover:text-indigo-800 transition duration-150 ease-in-out",children:"忘記密碼?"})]}),(0,n.jsx)("button",{type:"submit",className:"w-full bg-gradient-to-r from-blue-500 to-indigo-600 text-white py-3 rounded-lg hover:from-blue-600 hover:to-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition duration-200 ease-in-out transform hover:-translate-y-1 hover:shadow-lg disabled:opacity-50",disabled:b,children:b?"處理中...":t?"登入":"註冊"})]}),(0,n.jsx)("div",{className:"mt-6 text-center",children:(0,n.jsx)("button",{onClick:()=>o(!t),className:"text-sm text-indigo-600 hover:text-indigo-800 transition duration-150 ease-in-out",children:t?"還沒有帳號？點此註冊":"已有帳號？點此登入"})})]})]})}},6501:function(){},9008:function(e,t,o){e.exports=o(7219)},1163:function(e,t,o){e.exports=o(6036)}},function(e){e.O(0,[66,709,888,774,179],function(){return e(e.s=3236)}),_N_E=e.O()}]);